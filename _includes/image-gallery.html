{% assign items = include.images | split: ", " %}
{% assign gallery_height = include.height | default: "400" %}
{% assign gallery_id = include.id | default: page.url | slugify %}

<div class="glide" style="--gallery-height: {{ gallery_height }}px;">
  <div class="glide__track" data-glide-el="track">
    <ul class="glide__slides">

      {% for raw in items %}
        {% assign item = raw | strip %}

        {%- assign parts = item | split: "|" -%}
        {%- assign main = parts[0] | strip -%}
        {%- assign thumb = parts[1] | default: "" | strip -%}

        {%- assign is_video = false -%}
        {%- if main endswith ".mp4" or main endswith ".webm" or main endswith ".mov" -%}
          {%- assign is_video = true -%}
        {%- endif -%}

        <li class="glide__slide">

          {% if is_video %}
            <!-- Video -->
            <a
              href="{{ main }}"
              class="glightbox"
              data-gallery="gallery-{{ gallery_id }}"
              data-type="video"
              {% if thumb != "" %}data-poster="{{ thumb }}"{% endif %}
            >
              <img
                src="{% if thumb != "" %}{{ thumb }}{% else %}{{ main }}{% endif %}"
                alt="Video preview"
                loading="lazy"
              />
            </a>
          {% else %}
            <!-- Image -->
            <a
              href="{{ main }}"
              class="glightbox"
              data-gallery="gallery-{{ gallery_id }}"
            >
              <img
                src="{{ main }}"
                alt="{{ main }}"
                loading="lazy"
                onerror="this.onerror=null;this.src=this.src.replace('.webp','.png').replace('.png','.webp');"
              />
            </a>
          {% endif %}

        </li>
      {% endfor %}

    </ul>
  </div>

  <!-- Navigation arrows -->
  <div class="glide__arrows" data-glide-el="controls">
    <button class="glide__arrow glide__arrow--left" data-glide-dir="<">Prev</button>
    <button class="glide__arrow glide__arrow--right" data-glide-dir=">">Next</button>
  </div>
</div>
