{% assign items = include.images | split: ", " %}
{% assign gallery_height = include.height | default: "400" %}
{% assign gallery_id = include.id | default: page.url | slugify %}

<div class="glide" style="--gallery-height: {{ gallery_height }}px;">
  <div class="glide__track" data-glide-el="track">
    <ul class="glide__slides">

      {% for raw in items %}
        {% assign item = raw | strip %}
        {% assign parts = item | split: "|" %}
        {% assign main = parts[0] %}
        {% assign thumb = parts[1] %}

        {% assign is_video = main contains '.mp4' or main contains '.webm' or main contains '.mov' %}

        {% assign page_url_without_index = page.url | remove: 'index' | remove: '.html' %}
        {% assign src = main contains 'https://' | ternary: main, page_url_without_index | append: main %}

        <li class="glide__slide">

          {% if is_video and thumb %}
            <!-- Video (thumbnail only, plays on click) -->
            <a
              href="{{ src }}"
              class="glightbox"
              data-gallery="gallery-{{ gallery_id }}"
              data-type="video"
            >
              <img
                src="{{ page_url_without_index }}{{ thumb }}"
                alt="Video preview"
                loading="lazy"
              />
            </a>

          {% else %}
            <!-- Image -->
            <a
              href="{{ src }}"
              class="glightbox"
              data-gallery="gallery-{{ gallery_id }}"
            >
              <img
                src="{{ src }}"
                alt="{{ main }}"
                loading="lazy"
                onerror="this.onerror=null;this.src=this.src.replace('.webp','.png').replace('.png','.webp');"
              />
            </a>
          {% endif %}

        </li>
      {% endfor %}

    </ul>
  </div>

  <div class="glide__arrows" data-glide-el="controls">
    <button class="glide__arrow glide__arrow--left" data-glide-dir="<">Prev</button>
    <button class="glide__arrow glide__arrow--right" data-glide-dir=">">Next</button>
  </div>
</div>
