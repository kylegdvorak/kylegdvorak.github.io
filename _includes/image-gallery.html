{% assign items = include.images | split: ", " %}
{% assign gallery_height = include.height | default: "400" %}
{% assign gallery_id = include.id | default: page.url | slugify %}
{% assign base_url = page.url | remove: 'index' | remove: '.html' %}

<div class="glide" style="--gallery-height: {{ gallery_height }}px;">
  <div class="glide__track" data-glide-el="track">
    <ul class="glide__slides">

      {% for raw in items %}
        {% assign item = raw | strip %}
        {% assign parts = item | split: "|" %}
        {% assign main = parts[0] | strip %}
        {% assign thumb = parts[1] | default: "" | strip %}

        {% assign is_video = false %}
        {% if main contains ".mp4" or main contains ".webm" or main contains ".mov" %}
          {% assign is_video = true %}
        {% endif %}

        {% if main contains 'https://' %}
          {% assign main_src = main %}
        {% else %}
          {% assign main_src = base_url | append: main %}
        {% endif %}

        {% if thumb != "" %}
          {% if thumb contains 'https://' %}
            {% assign thumb_src = thumb %}
          {% else %}
            {% assign thumb_src = base_url | append: thumb %}
          {% endif %}
        {% else %}
          {% assign thumb_src = main_src %}
        {% endif %}

        <li class="glide__slide">

          {% if is_video %}
            <a
              href="{{ main_src }}"
              class="glightbox"
              data-gallery="gallery-{{ gallery_id }}"
              data-type="video"
              data-poster="{{ thumb_src }}"
            >
              <img src="{{ thumb_src }}" alt="Video preview" loading="lazy" />
            </a>
          {% else %}
            <a
              href="{{ main_src }}"
              class="glightbox"
              data-gallery="gallery-{{ gallery_id }}"
            >
              <img
                src="{{ main_src }}"
                alt="{{ main }}"
                loading="lazy"
                onerror="this.onerror=null;this.src=this.src.replace('.webp','.png').replace('.png','.webp');"
              />
            </a>
          {% endif %}

        </li>

      {% endfor %}

    </ul>
  </div>

  <div class="glide__arrows" data-glide-el="controls">
    <button class="glide__arrow glide__arrow--left" data-glide-dir="<">Prev</button>
    <button class="glide__arrow glide__arrow--right" data-glide-dir=">">Next</button>
  </div>
</div>
